15:38:18 SQL> @/dbbackups/ECPR/migrations/ops_owner/4-release-1.11.1-all/upgrade.sql
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> -- DDL for package NOTIFICATION_STATUSES
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> 
15:38:18 SQL> CREATE OR REPLACE PACKAGE "NOTIFICATION_STATUSES_V17" AS
15:38:18   2  
15:38:18   3  ----
15:38:18   4  -- NOTIFICATION STATUSES
15:38:18   5  
15:38:18   6  NOTIFICATION_SENT    CONSTANT NUMBER := 1;
15:38:18   7  NOTIFICATION_PENDING CONSTANT NUMBER := 2;
15:38:18   8  NOTIFICATION_FAILED  CONSTANT NUMBER := 3;
15:38:18   9  
15:38:18  10  END NOTIFICATION_STATUSES_V17;
15:38:18  11  .
15:38:18 SQL> /

Package created.

Elapsed: 00:00:00.04
15:38:18 SQL> 
15:38:18 SQL> 
15:38:18 SQL> 
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> -- DDL for package PROCS_COMMON
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> 
15:38:18 SQL> CREATE OR REPLACE PACKAGE "PROCS_COMMON_V17" AS
15:38:18   2  
15:38:18   3  FUNCTION GENERATE_EXCEPTION_MESSAGE(
15:38:18   4  	in_sproc_name	    IN VARCHAR2,
15:38:18   5  	in_error_message    IN VARCHAR2,
15:38:18   6  	in_error_stacktrace IN VARCHAR2 DEFAULT NULL
15:38:18   7  ) RETURN VARCHAR2;
15:38:18   8  
15:38:18   9  PROCEDURE THROW_EXCEPTION(
15:38:18  10  	in_exception_code   IN NUMBER,
15:38:18  11  	in_sproc_name	    IN VARCHAR2,
15:38:18  12  	in_error_message    IN VARCHAR2,
15:38:18  13  	in_error_stacktrace IN VARCHAR2 DEFAULT NULL
15:38:18  14  );
15:38:18  15  
15:38:18  16  END PROCS_COMMON_V17;
15:38:18  17  .
15:38:18 SQL> /

Package created.

Elapsed: 00:00:00.02
15:38:18 SQL> 
15:38:18 SQL> CREATE OR REPLACE PACKAGE BODY "PROCS_COMMON_V17" AS
15:38:18   2  
15:38:18   3  FUNCTION GENERATE_EXCEPTION_MESSAGE(
15:38:18   4  	in_sproc_name	    IN VARCHAR2,
15:38:18   5  	in_error_message    IN VARCHAR2,
15:38:18   6  	in_error_stacktrace IN VARCHAR2 DEFAULT NULL
15:38:18   7  ) RETURN VARCHAR2 AS
15:38:18   8  BEGIN
15:38:18   9  	IF in_error_stacktrace IS NOT NULL THEN
15:38:18  10  	  RETURN in_sproc_name || ': ' || in_error_message || ': ' || chr(10) || in_error_stacktrace;
15:38:18  11  	END IF;
15:38:18  12  	RETURN
15:38:18  13  	  in_sproc_name || ': ' || in_error_message;
15:38:18  14  END GENERATE_EXCEPTION_MESSAGE;
15:38:18  15  
15:38:18  16  /******************************************************************************/
15:38:18  17  
15:38:18  18  PROCEDURE THROW_EXCEPTION(
15:38:18  19  	in_exception_code   IN NUMBER,
15:38:18  20  	in_sproc_name	    IN VARCHAR2,
15:38:18  21  	in_error_message    IN VARCHAR2,
15:38:18  22  	in_error_stacktrace IN VARCHAR2 DEFAULT NULL
15:38:18  23  ) AS
15:38:18  24  BEGIN
15:38:18  25  	RAISE_APPLICATION_ERROR(in_exception_code, GENERATE_EXCEPTION_MESSAGE(in_sproc_name, in_error_message, in_error_stacktrace));
15:38:18  26  END;
15:38:18  27  
15:38:18  28  END PROCS_COMMON_V17;
15:38:18  29  .
15:38:18 SQL> /

Package body created.

Elapsed: 00:00:00.01
15:38:18 SQL> 
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> -- DDL for package PROCS_NOTIFICATION
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> 
15:38:18 SQL> CREATE OR REPLACE PACKAGE "PROCS_NOTIFICATION_V17" AS
15:38:18   2  
15:38:18   3  PROCEDURE GET_NOTIFICATION_TYPE_BY_NAME (
15:38:18   4  /*
15:38:18   5  Throws exceptions:
15:38:18   6  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18   7  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18   8  */
15:38:18   9  	in_notification_type_name IN VARCHAR2,
15:38:18  10  	out_notification_type_id  OUT NUMBER
15:38:18  11  );
15:38:18  12  
15:38:18  13  PROCEDURE ADD_NOTIFICATION (
15:38:18  14  /*
15:38:18  15  Throws exceptions:
15:38:18  16  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18  17  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18  18  */
15:38:18  19  	in_sender_account_id	 IN NUMBER DEFAULT 0,
15:38:18  20  	in_recipient_group_id	 IN NUMBER,
15:38:18  21  	in_notification_type_id  IN NUMBER,
15:38:18  22  	in_date_to_notify	 IN DATE,
15:38:18  23  	in_email_template_params IN CLOB
15:38:18  24  );
15:38:18  25  
15:38:18  26  PROCEDURE GET_PENDING_NOTIFICATIONS (
15:38:18  27  /*
15:38:18  28  Throws exceptions:
15:38:18  29  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18  30  */
15:38:18  31  	out_result_set OUT SYS_REFCURSOR
15:38:18  32  );
15:38:18  33  
15:38:18  34  PROCEDURE UPDATE_NOTIFICATION_TIMESTAMP (
15:38:18  35  /*
15:38:18  36  Throws exceptions:
15:38:18  37  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18  38  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18  39  */
15:38:18  40  	in_notification_id IN NUMBER
15:38:18  41  );
15:38:18  42  
15:38:18  43  PROCEDURE SET_NOTIFICATION_STATUS (
15:38:18  44  /*
15:38:18  45  Throws exceptions:
15:38:18  46  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18  47  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18  48  */
15:38:18  49  	in_notification_id	  IN NUMBER,
15:38:18  50  	in_notification_status_id IN NUMBER,
15:38:18  51  	in_error_message	  IN VARCHAR2
15:38:18  52  );
15:38:18  53  
15:38:18  54  PROCEDURE ADD_NOTIFICATION_FAILURE (
15:38:18  55  /*
15:38:18  56  Throws exceptions:
15:38:18  57  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18  58  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18  59  */
15:38:18  60  	in_notification_id IN NUMBER,
15:38:18  61  	in_error_message   IN VARCHAR2
15:38:18  62  );
15:38:18  63  
15:38:18  64  PROCEDURE LOCK_PENDING_NOTIFICATION (
15:38:18  65  /*
15:38:18  66  Result: 1 if notification locked
15:38:18  67  2 - else
15:38:18  68  */
15:38:18  69  	in_notification_id IN NUMBER,
15:38:18  70  	out_lock_status    OUT NUMBER
15:38:18  71  );
15:38:18  72  
15:38:18  73  PROCEDURE GET_NOTIFICATION_DATA (
15:38:18  74  	in_notification_id IN NUMBER,
15:38:18  75  	out_result_set	   OUT SYS_REFCURSOR
15:38:18  76  );
15:38:18  77  
15:38:18  78  END PROCS_NOTIFICATION_V17;
15:38:18  79  .
15:38:18 SQL> /

Package created.

Elapsed: 00:00:00.02
15:38:18 SQL> 
15:38:18 SQL> CREATE OR REPLACE PACKAGE BODY "PROCS_NOTIFICATION_V17" AS
15:38:18   2  
15:38:18   3  PROCEDURE GET_NOTIFICATION_TYPE_BY_NAME (
15:38:18   4  /*
15:38:18   5  Throws exceptions:
15:38:18   6  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18   7  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18   8  */
15:38:18   9  	in_notification_type_name IN VARCHAR2,
15:38:18  10  	out_notification_type_id  OUT NUMBER
15:38:18  11  ) AS
15:38:18  12  SPROC_NAME CONSTANT VARCHAR2(32) := 'GET_NOTIFICATION_TYPE_BY_NAME';
15:38:18  13  BEGIN
15:38:18  14  	SELECT
15:38:18  15  	  NOTIFICATION_TYPE.ID into out_notification_type_id
15:38:18  16  	FROM
15:38:18  17  	  NOTIFICATION_TYPE
15:38:18  18  	WHERE
15:38:18  19  	  NOTIFICATION_TYPE.VALUE = in_notification_type_name;
15:38:18  20  EXCEPTION
15:38:18  21  WHEN NO_DATA_FOUND THEN
15:38:18  22  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND,
15:38:18  23  	  SPROC_NAME, 'No such type');
15:38:18  24  WHEN OTHERS THEN
15:38:18  25  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR,
15:38:18  26  	  SPROC_NAME, 'Unknown error', SQLERRM);
15:38:18  27  END GET_NOTIFICATION_TYPE_BY_NAME;
15:38:18  28  
15:38:18  29  /******************************************************************/
15:38:18  30  
15:38:18  31  PROCEDURE ADD_NOTIFICATION (
15:38:18  32  /*
15:38:18  33  Throws exceptions:
15:38:18  34  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18  35  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18  36  */
15:38:18  37  	in_sender_account_id	 IN NUMBER DEFAULT 0,
15:38:18  38  	in_recipient_group_id	 IN NUMBER,
15:38:18  39  	in_notification_type_id  IN NUMBER,
15:38:18  40  	in_date_to_notify	 IN DATE,
15:38:18  41  	in_email_template_params IN CLOB
15:38:18  42  ) AS
15:38:18  43  SPROC_NAME CONSTANT VARCHAR2(32) := 'ADD_NOTIFICATION';
15:38:18  44  -- VARIABLES
15:38:18  45  temp_type_count NUMBER;
15:38:18  46  var_create_date DATE := SYSDATE;
15:38:18  47  -- EXCEPTIONS
15:38:18  48  BAD_NOTIFICATION_TYPE_ID EXCEPTION;
15:38:18  49  CAN_NOT_CREATE_HISTORY   EXCEPTION;
15:38:18  50  EXCEPTION_MESSAGE        VARCHAR2(1024);
15:38:18  51  BEGIN
15:38:18  52  
15:38:18  53  	SELECT
15:38:18  54  	  COUNT(*) into temp_type_count
15:38:18  55  	FROM
15:38:18  56  	  NOTIFICATION_TYPE
15:38:18  57  	WHERE
15:38:18  58  	  NOTIFICATION_TYPE.ID = in_notification_type_id;
15:38:18  59  
15:38:18  60  	IF temp_type_count = 0 THEN
15:38:18  61  	  RAISE BAD_NOTIFICATION_TYPE_ID;
15:38:18  62  	END IF;
15:38:18  63  
15:38:18  64  	INSERT INTO NOTIFICATION (
15:38:18  65  	  ID,
15:38:18  66  	  ACCOUNT_ID,
15:38:18  67  	  GROUP_ID,
15:38:18  68  	  NOTIFICATION_TYPE_ID,
15:38:18  69  	  NOTIFICATION_STATUS_ID,
15:38:18  70  	  EMAIL_TEMPLATE_PARAMS,
15:38:18  71  	  UPDATE_DATE,
15:38:18  72  	  CREATE_DATE,
15:38:18  73  	  DATE_TO_NOTIFY
15:38:18  74  	) VALUES (
15:38:18  75  	  NOT_ID_SEQ.nextVal,
15:38:18  76  	  in_sender_account_id,
15:38:18  77  	  in_recipient_group_id,
15:38:18  78  	  in_notification_type_id,
15:38:18  79  	  NOTIFICATION_STATUSES_V17.NOTIFICATION_PENDING,
15:38:18  80  	  in_email_template_params,
15:38:18  81  	  var_create_date,
15:38:18  82  	  var_create_date,
15:38:18  83  	  in_date_to_notify
15:38:18  84  	);
15:38:18  85  
15:38:18  86  	--BEGIN
15:38:18  87  	--  OPS_HIST_OWNER.PUBLIC_PROCS_OPS_V17.CREATE_NOTIFICATION_HISTORY (
15:38:18  88  	--    in_account_id		  => 0, -- ACCOUNT_ID. Can we delete it?
15:38:18  89  	--    in_group_id		  => in_recipient_group_id,
15:38:18  90  	--    notification_reason_type_id => in_notification_type_id,
15:38:18  91  	--    notification_status_id	  => NOTIFICATION_STATUSES_V17.NOTIFICATION_PENDING,
15:38:18  92  	--    email_template_params	  => in_email_template_params,
15:38:18  93  	--    in_create_date		  => var_create_date
15:38:18  94  	--  );
15:38:18  95  	--  EXCEPTION
15:38:18  96  	--    WHEN OTHERS THEN
15:38:18  97  	--	EXCEPTION_MESSAGE := SQLERRM;
15:38:18  98  	--	RAISE CAN_NOT_CREATE_HISTORY;
15:38:18  99  	--END;
15:38:18 100  
15:38:18 101  EXCEPTION
15:38:18 102  WHEN BAD_NOTIFICATION_TYPE_ID THEN
15:38:18 103  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND,
15:38:18 104  	  SPROC_NAME, 'No such notification status');
15:38:18 105  WHEN CAN_NOT_CREATE_HISTORY THEN
15:38:18 106  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.INTERNAL_ERROR,
15:38:18 107  	  SPROC_NAME, 'Could not create history', EXCEPTION_MESSAGE);
15:38:18 108  WHEN OTHERS THEN
15:38:18 109  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR,
15:38:18 110  	  SPROC_NAME, 'Unknown error', SQLERRM);
15:38:18 111  END ADD_NOTIFICATION;
15:38:18 112  
15:38:18 113  /******************************************************************************/
15:38:18 114  
15:38:18 115  PROCEDURE GET_PENDING_NOTIFICATIONS (
15:38:18 116  /*
15:38:18 117  Throws exceptions:
15:38:18 118  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18 119  */
15:38:18 120  	out_result_set OUT SYS_REFCURSOR
15:38:18 121  ) AS
15:38:18 122  SPROC_NAME CONSTANT VARCHAR2(32) := 'GET_PENDING_NOTIFICATIONS';
15:38:18 123  -- CONSTANTS
15:38:18 124  C_NOTIFICATION_COUNT_LIMIT CONSTANT NUMBER := 500;
15:38:18 125  BEGIN
15:38:18 126  	OPEN out_result_set FOR
15:38:18 127  SELECT * FROM
15:38:18 128  (
15:38:18 129  	SELECT
15:38:18 130  	  NOTIFICATION.ID
15:38:18 131  	FROM
15:38:18 132  	  NOTIFICATION
15:38:18 133  	  INNER JOIN NOTIFICATION_TYPE ON NOTIFICATION.NOTIFICATION_TYPE_ID = NOTIFICATION_TYPE.ID
15:38:18 134  	WHERE
15:38:18 135  	  ROWNUM <= C_NOTIFICATION_COUNT_LIMIT*10
15:38:18 136  	  AND NOT EXISTS (
15:38:18 137  	    SELECT NULL
15:38:18 138  	    FROM OPS_OWNER.PROCESS_RETRY_THROTTLE
15:38:18 139  	    WHERE GENERIC_ID = NOTIFICATION.ID AND PROCESS_NAME = SPROC_NAME
15:38:18 140  	  )
15:38:18 141  	  AND (
15:38:18 142  	    NOTIFICATION.NOTIFICATION_STATUS_ID = NOTIFICATION_STATUSES_V17.NOTIFICATION_PENDING
15:38:18 143  	    OR NOTIFICATION.NOTIFICATION_STATUS_ID = NOTIFICATION_STATUSES_V17.NOTIFICATION_FAILED
15:38:18 144  	  )
15:38:18 145  	  AND (
15:38:18 146  	    NOTIFICATION.DATE_TO_NOTIFY IS NULL OR SYSDATE > NOTIFICATION.DATE_TO_NOTIFY
15:38:18 147  	  )ORDER BY dbms_random.value
15:38:18 148  ) WHERE
15:38:18 149  	ROWNUM <= C_NOTIFICATION_COUNT_LIMIT;
15:38:18 150  
15:38:18 151  EXCEPTION
15:38:18 152  WHEN OTHERS THEN
15:38:18 153  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR,
15:38:18 154  	  SPROC_NAME, 'Unknown error', SQLERRM);
15:38:18 155  END GET_PENDING_NOTIFICATIONS;
15:38:18 156  
15:38:18 157  /******************************************************************************/
15:38:18 158  
15:38:18 159  PROCEDURE UPDATE_NOTIFICATION_TIMESTAMP (
15:38:18 160  /*
15:38:18 161  Throws exceptions:
15:38:18 162  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18 163  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18 164  */
15:38:18 165  	in_notification_id IN NUMBER
15:38:18 166  ) AS
15:38:18 167  SPROC_NAME CONSTANT VARCHAR2(32) := 'UPDATE_NOTIFICATION_TIMESTAMP';
15:38:18 168  -- VARIABLES
15:38:18 169  temp_notification_id NUMBER;
15:38:18 170  -- EXCEPTIONS
15:38:18 171  BAD_NOTIFICATION_ID EXCEPTION;
15:38:18 172  BEGIN
15:38:18 173  
15:38:18 174  	BEGIN
15:38:18 175  	  SELECT
15:38:18 176  	    NOTIFICATION.ID into temp_notification_id
15:38:18 177  	  FROM
15:38:18 178  	    NOTIFICATION
15:38:18 179  	  WHERE
15:38:18 180  	    NOTIFICATION.ID = in_notification_id;
15:38:18 181  	  EXCEPTION
15:38:18 182  	    WHEN NO_DATA_FOUND THEN
15:38:18 183  	      RAISE BAD_NOTIFICATION_ID;
15:38:18 184  	END;
15:38:18 185  
15:38:18 186  	UPDATE
15:38:18 187  	  NOTIFICATION
15:38:18 188  	SET
15:38:18 189  	  NOTIFICATION.UPDATE_DATE = sysdate
15:38:18 190  	WHERE
15:38:18 191  	  NOTIFICATION.ID = in_notification_id;
15:38:18 192  
15:38:18 193  EXCEPTION
15:38:18 194  WHEN BAD_NOTIFICATION_ID THEN
15:38:18 195  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND,
15:38:18 196  	  SPROC_NAME, 'No such notification');
15:38:18 197  WHEN OTHERS THEN
15:38:18 198  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR,
15:38:18 199  	  SPROC_NAME, 'Unknown error', SQLERRM);
15:38:18 200  END UPDATE_NOTIFICATION_TIMESTAMP;
15:38:18 201  
15:38:18 202  /******************************************************************************/
15:38:18 203  
15:38:18 204  PROCEDURE SET_NOTIFICATION_STATUS (
15:38:18 205  /*
15:38:18 206  Throws exceptions:
15:38:18 207  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18 208  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18 209  */
15:38:18 210  	in_notification_id	  IN NUMBER,
15:38:18 211  	in_notification_status_id IN NUMBER,
15:38:18 212  	in_error_message	  IN VARCHAR2
15:38:18 213  ) AS
15:38:18 214  SPROC_NAME CONSTANT VARCHAR2(32) := 'SET_NOTIFICATION_STATUS';
15:38:18 215  -- VARIABLES
15:38:18 216  var_group_id		NUMBER;
15:38:18 217  var_account_id		NUMBER;
15:38:18 218  var_notification_type_id	NUMBER;
15:38:18 219  var_email_template_params CLOB;
15:38:18 220  var_create_history_date	DATE := SYSDATE;
15:38:18 221  var_notification_status_id   NUMBER;
15:38:18 222  var_date_to_notify	DATE;
15:38:18 223  max_fails   NUMBER := 5;
15:38:18 224  num_fails   NUMBER;
15:38:18 225  -- EXCEPTIONS
15:38:18 226  BAD_NOTIFICATION_ID	 EXCEPTION;
15:38:18 227  BAD_NOTIFICATION_STATUS_ID EXCEPTION;
15:38:18 228  CAN_NOT_CREATE_HISTORY	 EXCEPTION;
15:38:18 229  EXCEPTION_MESSAGE 	 VARCHAR2(1024);
15:38:18 230  BEGIN
15:38:18 231  
15:38:18 232  	IF in_notification_status_id != NOTIFICATION_STATUSES_V17.NOTIFICATION_SENT
15:38:18 233  	  AND in_notification_status_id != NOTIFICATION_STATUSES_V17.NOTIFICATION_PENDING
15:38:18 234  	  AND in_notification_status_id != NOTIFICATION_STATUSES_V17.NOTIFICATION_FAILED THEN
15:38:18 235  	  RAISE BAD_NOTIFICATION_STATUS_ID;
15:38:18 236  	END IF;
15:38:18 237  
15:38:18 238  	BEGIN
15:38:18 239  	  SELECT
15:38:18 240  	    NOTIFICATION.GROUP_ID,
15:38:18 241  	    NOTIFICATION.ACCOUNT_ID,
15:38:18 242  	    NOTIFICATION.NOTIFICATION_TYPE_ID,
15:38:18 243  	    NOTIFICATION.NOTIFICATION_STATUS_ID,
15:38:18 244  	    NOTIFICATION.EMAIL_TEMPLATE_PARAMS,
15:38:18 245  	    NOTIFICATION.DATE_TO_NOTIFY
15:38:18 246  	    into
15:38:18 247  	    var_group_id,
15:38:18 248  	    var_account_id,
15:38:18 249  	    var_notification_type_id,
15:38:18 250  	    var_notification_status_id,
15:38:18 251  	    var_email_template_params,
15:38:18 252  	    var_date_to_notify
15:38:18 253  	  FROM
15:38:18 254  	    NOTIFICATION
15:38:18 255  	  WHERE
15:38:18 256  	    NOTIFICATION.ID = in_notification_id;
15:38:18 257  	  EXCEPTION
15:38:18 258  	    WHEN NO_DATA_FOUND THEN
15:38:18 259  	      RAISE BAD_NOTIFICATION_ID;
15:38:18 260  	END;
15:38:18 261  
15:38:18 262  	BEGIN
15:38:18 263  	  OPS_HIST_OWNER.PUBLIC_PROCS_OPS_V17.CREATE_NOTIFICATION_HISTORY (
15:38:18 264  	    in_notification_id		=> in_notification_id,
15:38:18 265  	    in_account_id		=> var_account_id,
15:38:18 266  	    in_group_id 		=> var_group_id,
15:38:18 267  	    notification_reason_type_id => var_notification_type_id,
15:38:18 268  	    notification_status_id	=> var_notification_status_id,
15:38:18 269  	    email_template_params	=> var_email_template_params,
15:38:18 270  	    in_create_date		=> var_create_history_date,
15:38:18 271  	    in_date_to_notify		=> var_date_to_notify
15:38:18 272  	  );
15:38:18 273  	  EXCEPTION
15:38:18 274  	    WHEN OTHERS THEN
15:38:18 275  	      EXCEPTION_MESSAGE := SQLERRM;
15:38:18 276  	      RAISE CAN_NOT_CREATE_HISTORY;
15:38:18 277  	END;
15:38:18 278  
15:38:18 279  	UPDATE
15:38:18 280  	  NOTIFICATION
15:38:18 281  	SET
15:38:18 282  	  NOTIFICATION.NOTIFICATION_STATUS_ID = in_notification_status_id,
15:38:18 283  	  NOTIFICATION.UPDATE_DATE = sysdate
15:38:18 284  	WHERE
15:38:18 285  	  NOTIFICATION.ID = in_notification_id;
15:38:18 286  
15:38:18 287  	IF ( in_error_message IS NOT NULL ) THEN
15:38:18 288  	  ADD_NOTIFICATION_FAILURE(
15:38:18 289  	    in_notification_id => in_notification_id,
15:38:18 290  	    in_error_message => in_error_message
15:38:18 291  	  );
15:38:18 292  	END IF;
15:38:18 293  
15:38:18 294  	SELECT COUNT(1) INTO num_fails
15:38:18 295  	FROM NOTIFICATION_FAILURE
15:38:18 296  	WHERE NOTIFICATION_ID = in_notification_id;
15:38:18 297  
15:38:18 298  	IF (in_notification_status_id = NOTIFICATION_STATUSES_V17.NOTIFICATION_SENT OR num_fails >= max_fails) then
15:38:18 299  	  FOR REC IN (
15:38:18 300  	      SELECT ID, NOTIFICATION_ID, ERROR_MESSAGE, CREATE_DATE
15:38:18 301  	      FROM NOTIFICATION_FAILURE
15:38:18 302  	      WHERE NOTIFICATION_ID = in_notification_id
15:38:18 303  	      ) LOOP
15:38:18 304  	      BEGIN
15:38:18 305  		OPS_HIST_OWNER.PUBLIC_PROCS_OPS_V17.CREATE_NOTIF_FAILURE_HISTORY(
15:38:18 306  		  in_error_message	   => REC.ERROR_MESSAGE,
15:38:18 307  		  in_notification_id	   => REC.NOTIFICATION_ID,
15:38:18 308  		  in_create_date	   => REC.CREATE_DATE
15:38:18 309  		);
15:38:18 310  		EXCEPTION
15:38:18 311  		  WHEN OTHERS THEN
15:38:18 312  		    EXCEPTION_MESSAGE := SQLERRM;
15:38:18 313  		    RAISE CAN_NOT_CREATE_HISTORY;
15:38:18 314  	      END;
15:38:18 315  	  END LOOP;
15:38:18 316  	  DELETE FROM NOTIFICATION_FAILURE WHERE NOTIFICATION_ID = in_notification_id;
15:38:18 317  
15:38:18 318  	  BEGIN
15:38:18 319  	    SELECT
15:38:18 320  	      NOTIFICATION.GROUP_ID,
15:38:18 321  	      NOTIFICATION.ACCOUNT_ID,
15:38:18 322  	      NOTIFICATION.NOTIFICATION_TYPE_ID,
15:38:18 323  	      NOTIFICATION.NOTIFICATION_STATUS_ID,
15:38:18 324  	      NOTIFICATION.EMAIL_TEMPLATE_PARAMS,
15:38:18 325  	      NOTIFICATION.DATE_TO_NOTIFY
15:38:18 326  	      into
15:38:18 327  	      var_group_id,
15:38:18 328  	      var_account_id,
15:38:18 329  	      var_notification_type_id,
15:38:18 330  	      var_notification_status_id,
15:38:18 331  	      var_email_template_params,
15:38:18 332  	      var_date_to_notify
15:38:18 333  	    FROM
15:38:18 334  	      NOTIFICATION
15:38:18 335  	    WHERE
15:38:18 336  	      NOTIFICATION.ID = in_notification_id;
15:38:18 337  	    EXCEPTION
15:38:18 338  	      WHEN NO_DATA_FOUND THEN
15:38:18 339  		RAISE BAD_NOTIFICATION_ID;
15:38:18 340  	  END;
15:38:18 341  
15:38:18 342  	  BEGIN
15:38:18 343  	    OPS_HIST_OWNER.PUBLIC_PROCS_OPS_V17.CREATE_NOTIFICATION_HISTORY (
15:38:18 344  	      in_notification_id	  => in_notification_id,
15:38:18 345  	      in_account_id		  => var_account_id,
15:38:18 346  	      in_group_id		  => var_group_id,
15:38:18 347  	      notification_reason_type_id => var_notification_type_id,
15:38:18 348  	      notification_status_id	  => var_notification_status_id,
15:38:18 349  	      email_template_params	  => var_email_template_params,
15:38:18 350  	      in_create_date		  => var_create_history_date,
15:38:18 351  	      in_date_to_notify 	  => var_date_to_notify
15:38:18 352  	    );
15:38:18 353  	    EXCEPTION
15:38:18 354  	      WHEN OTHERS THEN
15:38:18 355  		EXCEPTION_MESSAGE := SQLERRM;
15:38:18 356  		RAISE CAN_NOT_CREATE_HISTORY;
15:38:18 357  	  END;
15:38:18 358  
15:38:18 359  	  DELETE FROM NOTIFICATION WHERE ID = in_notification_id;
15:38:18 360  
15:38:18 361  	END IF;
15:38:18 362  	commit;
15:38:18 363  
15:38:18 364  EXCEPTION
15:38:18 365  WHEN BAD_NOTIFICATION_STATUS_ID THEN
15:38:18 366  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND,
15:38:18 367  	  SPROC_NAME, 'Bad notification status');
15:38:18 368  WHEN BAD_NOTIFICATION_ID THEN
15:38:18 369  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND,
15:38:18 370  	  SPROC_NAME, 'No such notification');
15:38:18 371  WHEN CAN_NOT_CREATE_HISTORY THEN
15:38:18 372  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.INTERNAL_ERROR,
15:38:18 373  	  SPROC_NAME, 'Could not create history', EXCEPTION_MESSAGE);
15:38:18 374  WHEN OTHERS THEN
15:38:18 375  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR,
15:38:18 376  	  SPROC_NAME, 'Unknown error', SQLERRM);
15:38:18 377  END SET_NOTIFICATION_STATUS;
15:38:18 378  
15:38:18 379  /******************************************************************************/
15:38:18 380  
15:38:18 381  PROCEDURE ADD_NOTIFICATION_FAILURE (
15:38:18 382  /*
15:38:18 383  Throws exceptions:
15:38:18 384  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18 385  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18 386  */
15:38:18 387  	in_notification_id IN NUMBER,
15:38:18 388  	in_error_message   IN VARCHAR2
15:38:18 389  ) AS
15:38:18 390  SPROC_NAME CONSTANT VARCHAR2(32) := 'ADD_NOTIFICATION_FAILURE';
15:38:18 391  -- VARIABLES
15:38:18 392  temp_notification_id NUMBER;
15:38:18 393  var_create_date	   DATE := SYSDATE;
15:38:18 394  -- EXCEPTIONS
15:38:18 395  BAD_NOTIFICATION_ID	 EXCEPTION;
15:38:18 396  CAN_NOT_CREATE_HISTORY	 EXCEPTION;
15:38:18 397  EXCEPTION_MESSAGE 	 VARCHAR2(1024);
15:38:18 398  BEGIN
15:38:18 399  
15:38:18 400  	BEGIN
15:38:18 401  	  SELECT
15:38:18 402  	    NOTIFICATION.ID into temp_notification_id
15:38:18 403  	  FROM
15:38:18 404  	    NOTIFICATION
15:38:18 405  	  WHERE
15:38:18 406  	    NOTIFICATION.ID = in_notification_id;
15:38:18 407  	  EXCEPTION
15:38:18 408  	    WHEN NO_DATA_FOUND THEN
15:38:18 409  	      RAISE BAD_NOTIFICATION_ID;
15:38:18 410  	END;
15:38:18 411  
15:38:18 412  	INSERT INTO NOTIFICATION_FAILURE (
15:38:18 413  	  ID,
15:38:18 414  	  NOTIFICATION_ID,
15:38:18 415  	  ERROR_MESSAGE,
15:38:18 416  	  CREATE_DATE
15:38:18 417  	) VALUES (
15:38:18 418  	  NOTF_ID_SEQ.nextVal,
15:38:18 419  	  in_notification_id,
15:38:18 420  	  in_error_message,
15:38:18 421  	  sysdate
15:38:18 422  	);
15:38:18 423  
15:38:18 424  	--BEGIN
15:38:18 425  	--  OPS_HIST_OWNER.PUBLIC_PROCS_OPS_V17.CREATE_NOTIF_FAILURE_HISTORY(
15:38:18 426  	--    in_error_message	       => in_error_message,
15:38:18 427  	--    in_notification_queue_id => in_notification_id,
15:38:18 428  	--    in_create_date	       => var_create_date
15:38:18 429  	--  );
15:38:18 430  	--  EXCEPTION
15:38:18 431  	--    WHEN OTHERS THEN
15:38:18 432  	--	EXCEPTION_MESSAGE := SQLERRM;
15:38:18 433  	--	RAISE CAN_NOT_CREATE_HISTORY;
15:38:18 434  	--END;
15:38:18 435  
15:38:18 436  EXCEPTION
15:38:18 437  WHEN BAD_NOTIFICATION_ID THEN
15:38:18 438  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND,
15:38:18 439  	  SPROC_NAME, 'No such notification');
15:38:18 440  WHEN CAN_NOT_CREATE_HISTORY THEN
15:38:18 441  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.INTERNAL_ERROR,
15:38:18 442  	  SPROC_NAME, 'Could not create history', EXCEPTION_MESSAGE);
15:38:18 443  WHEN OTHERS THEN
15:38:18 444  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR,
15:38:18 445  	  SPROC_NAME, 'Unknown error', SQLERRM);
15:38:18 446  END ADD_NOTIFICATION_FAILURE;
15:38:18 447  
15:38:18 448  /******************************************************************************/
15:38:18 449  
15:38:18 450  PROCEDURE LOCK_PENDING_NOTIFICATION (
15:38:18 451  /*
15:38:18 452  Result: GLOBAL_STATUSES.TRUE if notification locked
15:38:18 453  GLOBA_STATUSES.FALSE - else
15:38:18 454  */
15:38:18 455  	in_notification_id IN NUMBER,
15:38:18 456  	out_lock_status    OUT NUMBER
15:38:18 457  ) AS
15:38:18 458  SPROC_NAME CONSTANT VARCHAR2(25) := 'LOCK_PENDING_NOTIFICATION';
15:38:18 459  -- VARIABLE
15:38:18 460  temp_notification_id NUMBER;
15:38:18 461  BEGIN
15:38:18 462  	SELECT
15:38:18 463  	  NOTIFICATION.ID into temp_notification_id
15:38:18 464  	FROM
15:38:18 465  	  NOTIFICATION
15:38:18 466  	WHERE
15:38:18 467  	  NOTIFICATION.ID = in_notification_id
15:38:18 468  	  AND (
15:38:18 469  	    NOTIFICATION.NOTIFICATION_STATUS_ID = NOTIFICATION_STATUSES_V17.NOTIFICATION_PENDING
15:38:18 470  	    OR NOTIFICATION.NOTIFICATION_STATUS_ID = NOTIFICATION_STATUSES_V17.NOTIFICATION_FAILED
15:38:18 471  	  )
15:38:18 472  	FOR UPDATE;
15:38:18 473  
15:38:18 474  	out_lock_status := 1;
15:38:18 475  
15:38:18 476  EXCEPTION
15:38:18 477  WHEN NO_DATA_FOUND THEN
15:38:18 478  	out_lock_status := 0;
15:38:18 479  WHEN OTHERS THEN
15:38:18 480  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR,
15:38:18 481  	  SPROC_NAME, 'Unknown error', SQLERRM);
15:38:18 482  END LOCK_PENDING_NOTIFICATION;
15:38:18 483  
15:38:18 484  /******************************************************************************/
15:38:18 485  
15:38:18 486  PROCEDURE GET_NOTIFICATION_DATA (
15:38:18 487  	in_notification_id IN NUMBER,
15:38:18 488  	out_result_set	   OUT SYS_REFCURSOR
15:38:18 489  ) AS
15:38:18 490  SPROC_NAME CONSTANT VARCHAR2(21) := 'GET_NOTIFICATION_DATA';
15:38:18 491  BEGIN
15:38:18 492  	OPEN out_result_set FOR
15:38:18 493  	SELECT
15:38:18 494  	  NOTIFICATION.ID,
15:38:18 495  	  NOTIFICATION.GROUP_ID,
15:38:18 496  	  NOTIFICATION.EMAIL_TEMPLATE_PARAMS,
15:38:18 497  	  NOTIFICATION.NOTIFICATION_STATUS_ID,
15:38:18 498  	  NOTIFICATION.CREATE_DATE,
15:38:18 499  	  NOTIFICATION.UPDATE_DATE,
15:38:18 500  	  NOTIFICATION.NOTIFICATION_TYPE_ID,
15:38:18 501  	  NOTIFICATION_TYPE.VALUE as "TYPE_VALUE",
15:38:18 502  	  NOTIFICATION_TYPE.TEMPLATE_URL
15:38:18 503  	FROM
15:38:18 504  	  NOTIFICATION
15:38:18 505  	  INNER JOIN NOTIFICATION_TYPE ON NOTIFICATION.NOTIFICATION_TYPE_ID = NOTIFICATION_TYPE.ID
15:38:18 506  	WHERE
15:38:18 507  	  NOTIFICATION.ID = in_notification_id;
15:38:18 508  
15:38:18 509  EXCEPTION
15:38:18 510  WHEN OTHERS THEN
15:38:18 511  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR,
15:38:18 512  	  SPROC_NAME, 'Unknown error', SQLERRM);
15:38:18 513  END GET_NOTIFICATION_DATA;
15:38:18 514  
15:38:18 515  END PROCS_NOTIFICATION_V17;
15:38:18 516  .
15:38:18 SQL> /

Package body created.

Elapsed: 00:00:00.05
15:38:18 SQL> 
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> -- DDL for package PROCS_PROCESS_RETRY_THROTTLE
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> 
15:38:18 SQL> CREATE OR REPLACE PACKAGE "PROCS_PROCESS_RETRY_V17" AS
15:38:18   2  
15:38:18   3  PROCEDURE LOG_RETRY(
15:38:18   4  	  in_process_name IN VARCHAR2,
15:38:18   5  	  in_generic_id   IN NUMBER,
15:38:18   6  	  in_date	  IN VARCHAR2,
15:38:18   7  	  out_success	   OUT NUMBER
15:38:18   8  );
15:38:18   9  
15:38:18  10  PROCEDURE LOG_RETRY_DATE(
15:38:18  11  	  in_process_name IN VARCHAR2,
15:38:18  12  	  in_generic_id   IN NUMBER,
15:38:18  13  	  in_date	  IN DATE,
15:38:18  14  	  out_success	   OUT NUMBER
15:38:18  15  );
15:38:18  16  
15:38:18  17  PROCEDURE DELETE_RETRY(
15:38:18  18  	  in_process_name IN VARCHAR2,
15:38:18  19  	  in_remove_minutes  IN NUMBER
15:38:18  20  );
15:38:18  21  
15:38:18  22  PROCEDURE GET_SYSDATE (
15:38:18  23  	  out_date OUT VARCHAR2
15:38:18  24  );
15:38:18  25  
15:38:18  26  END PROCS_PROCESS_RETRY_V17;
15:38:18  27  .
15:38:18 SQL> /

Package created.

Elapsed: 00:00:00.03
15:38:18 SQL> 
15:38:18 SQL> CREATE OR REPLACE PACKAGE BODY "PROCS_PROCESS_RETRY_V17" AS
15:38:18   2  
15:38:18   3  PROCEDURE LOG_RETRY(
15:38:18   4  	  in_process_name IN VARCHAR2,
15:38:18   5  	  in_generic_id   IN NUMBER,
15:38:18   6  	  in_date	  IN VARCHAR2,
15:38:18   7  	  out_success	   OUT NUMBER
15:38:18   8  ) AS
15:38:18   9  SPROC_NAME CONSTANT VARCHAR2(32) := 'PROCS_PROCESS_RETRY_V17';
15:38:18  10  BEGIN
15:38:18  11  
15:38:18  12  	out_success := 1;
15:38:18  13  	INSERT into PROCESS_RETRY_THROTTLE(process_name, generic_id, RETRY_count, create_date, update_date)
15:38:18  14  	VALUES (in_process_name, in_generic_id, 1, to_date(in_date, 'DD-Mon-YYYY HH24:MI:SS'), sysdate);
15:38:18  15  	commit;
15:38:18  16  EXCEPTION
15:38:18  17  WHEN DUP_VAL_ON_INDEX THEN
15:38:18  18  	rollback;
15:38:18  19  	out_success := 0;
15:38:18  20  WHEN OTHERS THEN
15:38:18  21  	rollback;
15:38:18  22  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR,
15:38:18  23  	  SPROC_NAME, 'Unknown error', SQLERRM);
15:38:18  24  
15:38:18  25  END;
15:38:18  26  
15:38:18  27  PROCEDURE LOG_RETRY_DATE(
15:38:18  28  	  in_process_name IN VARCHAR2,
15:38:18  29  	  in_generic_id   IN NUMBER,
15:38:18  30  	  in_date	  IN DATE,
15:38:18  31  	  out_success	   OUT NUMBER
15:38:18  32  ) AS
15:38:18  33  SPROC_NAME CONSTANT VARCHAR2(32) := 'PROCS_PROCESS_RETRY_V17';
15:38:18  34  BEGIN
15:38:18  35  
15:38:18  36  	out_success := 1;
15:38:18  37  	INSERT into PROCESS_RETRY_THROTTLE(process_name, generic_id, RETRY_count, create_date, update_date)
15:38:18  38  	VALUES (in_process_name, in_generic_id, 1, in_date, sysdate);
15:38:18  39  	commit;
15:38:18  40  EXCEPTION
15:38:18  41  WHEN DUP_VAL_ON_INDEX THEN
15:38:18  42  	rollback;
15:38:18  43  	out_success := 0;
15:38:18  44  WHEN OTHERS THEN
15:38:18  45  	rollback;
15:38:18  46  	PROCS_COMMON_V17.THROW_EXCEPTION(CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR,
15:38:18  47  	  SPROC_NAME, 'Unknown error', SQLERRM);
15:38:18  48  
15:38:18  49  END;
15:38:18  50  
15:38:18  51  PROCEDURE DELETE_RETRY(
15:38:18  52  	  in_process_name IN VARCHAR2,
15:38:18  53  	  in_remove_minutes  IN NUMBER
15:38:18  54  ) AS
15:38:18  55  BEGIN
15:38:18  56  
15:38:18  57  delete from PROCESS_RETRY_THROTTLE
15:38:18  58  where
15:38:18  59  	process_name = in_process_name and
15:38:18  60  	create_date <= sysdate-in_remove_minutes/1440;
15:38:18  61  commit;
15:38:18  62  END;
15:38:18  63  
15:38:18  64  PROCEDURE GET_SYSDATE (
15:38:18  65  	out_date  OUT VARCHAR2
15:38:18  66  ) AS
15:38:18  67  BEGIN
15:38:18  68  	SELECT to_char(SYSDATE, 'DD-Mon-YYYY HH24:MI:SS') into out_date from dual;
15:38:18  69  END;
15:38:18  70  
15:38:18  71  END PROCS_PROCESS_RETRY_V17;
15:38:18  72  .
15:38:18 SQL> /

Package body created.

Elapsed: 00:00:00.02
15:38:18 SQL> 
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> -- DDL for package PROCS_SYSTEM
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> 
15:38:18 SQL> CREATE OR REPLACE PACKAGE "PROCS_SYSTEM_V17" AS
15:38:18   2  
15:38:18   3  PROCEDURE INCREMENT_VERSION;
15:38:18   4  
15:38:18   5  PROCEDURE CHECK_VERSION(
15:38:18   6  	  in_vers    IN NUMBER,
15:38:18   7  	  out_result OUT NUMBER
15:38:18   8  );
15:38:18   9  
15:38:18  10  END PROCS_SYSTEM_V17;
15:38:18  11  .
15:38:18 SQL> /

Package created.

Elapsed: 00:00:00.02
15:38:18 SQL> 
15:38:18 SQL> CREATE OR REPLACE PACKAGE BODY "PROCS_SYSTEM_V17" AS
15:38:18   2  
15:38:18   3  PROCEDURE INCREMENT_VERSION
15:38:18   4  /*
15:38:18   5  Throws exceptions:
15:38:18   6  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18   7  */
15:38:18   8  AS
15:38:18   9  BEGIN
15:38:18  10  
15:38:18  11  	UPDATE SYS_VERSION SET version=version+1;
15:38:18  12  
15:38:18  13  EXCEPTION
15:38:18  14  WHEN OTHERS THEN
15:38:18  15  	RAISE_APPLICATION_ERROR(CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR,
15:38:18  16  	  'Unknown error');
15:38:18  17  END INCREMENT_VERSION;
15:38:18  18  
15:38:18  19  /*************************************************************/
15:38:18  20  
15:38:18  21  PROCEDURE CHECK_VERSION(
15:38:18  22  	  in_vers    IN NUMBER,
15:38:18  23  	  out_result OUT NUMBER
15:38:18  24  ) AS
15:38:18  25  	current_version NUMBER;
15:38:18  26  BEGIN
15:38:18  27  	SELECT version INTO current_version FROM SYS_VERSION;
15:38:18  28  	IF(current_version != in_vers) THEN
15:38:18  29  	  out_result := 1;
15:38:18  30  	ELSE
15:38:18  31  	  out_result := 0;
15:38:18  32  	END IF;
15:38:18  33  	EXCEPTION
15:38:18  34  	      WHEN OTHERS THEN
15:38:18  35  	      NULL;
15:38:18  36  END CHECK_VERSION;
15:38:18  37  
15:38:18  38  END PROCS_SYSTEM_V17;
15:38:18  39  .
15:38:18 SQL> /

Package body created.

Elapsed: 00:00:00.02
15:38:18 SQL> 
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> -- DDL for package PUBLIC_PROCS_CLIENT
15:38:18 SQL> --------------------------------------------------------------------------------
15:38:18 SQL> 
15:38:18 SQL> CREATE OR REPLACE PACKAGE "PUBLIC_PROCS_CLIENT_V17" AS
15:38:18   2  
15:38:18   3  PROCEDURE GET_NOTIFICATION_TYPE_BY_NAME (
15:38:18   4  /*
15:38:18   5  Throws exceptions:
15:38:18   6  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18   7  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18   8  */
15:38:18   9  	in_notification_type_name IN VARCHAR2,
15:38:18  10  	out_notification_type_id  OUT NUMBER
15:38:18  11  );
15:38:18  12  
15:38:18  13  PROCEDURE ADD_NOTIFICATION (
15:38:18  14  /*
15:38:18  15  Throws exceptions:
15:38:18  16  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18  17  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18  18  */
15:38:18  19  	in_sender_account_id	 IN NUMBER DEFAULT 0,
15:38:18  20  	in_recipient_group_id	 IN NUMBER,
15:38:18  21  	in_notification_type_id  IN NUMBER,
15:38:18  22  	in_date_to_notify	 IN DATE,
15:38:18  23  	in_email_template_params IN CLOB
15:38:18  24  );
15:38:18  25  
15:38:18  26  END PUBLIC_PROCS_CLIENT_V17;
15:38:18  27  .
15:38:18 SQL> /

Package created.

Elapsed: 00:00:00.02
15:38:18 SQL> 
15:38:18 SQL> CREATE OR REPLACE PACKAGE BODY "PUBLIC_PROCS_CLIENT_V17" AS
15:38:18   2  
15:38:18   3  PROCEDURE GET_NOTIFICATION_TYPE_BY_NAME (
15:38:18   4  /*
15:38:18   5  Throws exceptions:
15:38:18   6  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18   7  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18   8  */
15:38:18   9  	in_notification_type_name IN VARCHAR2,
15:38:18  10  	out_notification_type_id  OUT NUMBER
15:38:18  11  ) AS
15:38:18  12  BEGIN
15:38:18  13  	PROCS_NOTIFICATION_V17.GET_NOTIFICATION_TYPE_BY_NAME (
15:38:18  14  	  in_notification_type_name,
15:38:18  15  	  out_notification_type_id
15:38:18  16  	);
15:38:18  17  END;
15:38:18  18  
15:38:18  19  /*****************************************************************/
15:38:18  20  
15:38:18  21  PROCEDURE ADD_NOTIFICATION (
15:38:18  22  /*
15:38:18  23  Throws exceptions:
15:38:18  24  CORE_OWNER.APP_EXCEPTION_CODES_V17.NOT_FOUND
15:38:18  25  CORE_OWNER.APP_EXCEPTION_CODES_V17.UNKNOWN_ERROR
15:38:18  26  */
15:38:18  27  	in_sender_account_id	 IN NUMBER DEFAULT 0,
15:38:18  28  	in_recipient_group_id	 IN NUMBER,
15:38:18  29  	in_notification_type_id  IN NUMBER,
15:38:18  30  	in_date_to_notify	 IN DATE,
15:38:18  31  	in_email_template_params IN CLOB
15:38:18  32  ) AS
15:38:18  33  BEGIN
15:38:18  34  	PROCS_NOTIFICATION_V17.ADD_NOTIFICATION (
15:38:18  35  	  in_sender_account_id,
15:38:18  36  	  in_recipient_group_id,
15:38:18  37  	  in_notification_type_id,
15:38:18  38  	  in_date_to_notify,
15:38:18  39  	  in_email_template_params
15:38:18  40  	);
15:38:18  41  END;
15:38:18  42  
15:38:18  43  END PUBLIC_PROCS_CLIENT_V17;
15:38:18  44  .
15:38:18 SQL> /

Package body created.

Elapsed: 00:00:00.01
15:38:18 SQL> 
15:38:18 SQL> grant execute on OPS_OWNER.NOTIFICATION_STATUSES_V17 to ops_aaa_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_NOTIFICATION_V17 to ops_aaa_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_SYSTEM_V17 to ops_aaa_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> 
15:38:18 SQL> grant execute on OPS_OWNER.NOTIFICATION_STATUSES_V17 to ops_payment_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_NOTIFICATION_V17 to ops_payment_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_SYSTEM_V17 to ops_payment_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> 
15:38:18 SQL> grant execute on OPS_OWNER.NOTIFICATION_STATUSES_V17 to ops_notif_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_NOTIFICATION_V17 to ops_notif_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_SYSTEM_V17 to ops_notif_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> 
15:38:18 SQL> grant execute on OPS_OWNER.PUBLIC_PROCS_CLIENT_V17 to core_licensing_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PUBLIC_PROCS_CLIENT_V17 to core_billing_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PUBLIC_PROCS_CLIENT_V17 to core_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant execute on OPS_OWNER.PUBLIC_PROCS_CLIENT_V17 to cupy_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> 
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_PROCESS_RETRY_V17 to core_owner;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_PROCESS_RETRY_V17 to core_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_PROCESS_RETRY_V17 to cupy_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_PROCESS_RETRY_V17 to core_billing_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_PROCESS_RETRY_V17 to core_licensing_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_PROCESS_RETRY_V17 to ops_notif_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_PROCESS_RETRY_V17 to etl_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_PROCESS_RETRY_V17 to core_subup_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_PROCESS_RETRY_V17 to core_poller_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant execute on OPS_OWNER.PROCS_PROCESS_RETRY_V17 to core_subup_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> 
15:38:18 SQL> grant select on OPS_OWNER.PROCESS_RETRY_THROTTLE to core_owner;

Grant succeeded.

Elapsed: 00:00:00.03
15:38:18 SQL> grant select on OPS_OWNER.PROCESS_RETRY_THROTTLE to core_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant select on OPS_OWNER.PROCESS_RETRY_THROTTLE to cupy_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant select on OPS_OWNER.PROCESS_RETRY_THROTTLE to core_billing_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant select on OPS_OWNER.PROCESS_RETRY_THROTTLE to core_licensing_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant select on OPS_OWNER.PROCESS_RETRY_THROTTLE to core_subup_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> 
15:38:18 SQL> grant select on OPS_OWNER.NOTIFICATION_TYPE to core_owner;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant select on OPS_OWNER.NOTIFICATION_TYPE to core_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant select on OPS_OWNER.NOTIFICATION_TYPE to cupy_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant select on OPS_OWNER.NOTIFICATION_TYPE to core_billing_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant select on OPS_OWNER.NOTIFICATION_TYPE to core_licensing_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> 
15:38:18 SQL> grant REFERENCES on OPS_OWNER.NOTIFICATION_TYPE to core_owner;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant REFERENCES on OPS_OWNER.NOTIFICATION_TYPE to core_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant REFERENCES on OPS_OWNER.NOTIFICATION_TYPE to cupy_app;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant REFERENCES on OPS_OWNER.NOTIFICATION_TYPE to core_billing_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant REFERENCES on OPS_OWNER.NOTIFICATION_TYPE to core_licensing_app;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> 
15:38:18 SQL> grant select, insert, update, delete ON OPS_OWNER.NOTIFICATION_TYPE to core_owner;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant select ON OPS_OWNER.NOTTID_SEQ to core_owner;

Grant succeeded.

Elapsed: 00:00:00.02
15:38:18 SQL> 
15:38:18 SQL> grant select on OPS_OWNER.NOTIFICATION to core_owner;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> grant select on OPS_OWNER.NOTIFICATION_FAILURE to core_owner;

Grant succeeded.

Elapsed: 00:00:00.00
15:38:18 SQL> grant select on OPS_OWNER.NOTIFICATION_STATUS to core_owner;

Grant succeeded.

Elapsed: 00:00:00.01
15:38:18 SQL> commit;

Commit complete.

Elapsed: 00:00:00.00
15:38:18 SQL> spool off;


Subject: Nomad upgrade completed successfully: ECPR@rac01.prd.ewr1.nytimes.com
From: Nomad for Oracle <nytd_oracledba@nytimes.com>
To: nytd_ecommerce@nytimes.com,nytd_oracledba@nytimes.com
Cc: nytd_oracledba@nytimes.com
Nomad upgrade operation completed successfully without errors. 
        
        Details
        -------
        DB Hostname: rac01.prd.ewr1.nytimes.com
        SID: ECPR
        Schema: ops_owner
        Migration: 4-release-1.11.1-all
        SVN Revision: 10382
        Duration: 1 sec.
        Service Request: https://jira.em.nytimes.com/browse/ORA-348