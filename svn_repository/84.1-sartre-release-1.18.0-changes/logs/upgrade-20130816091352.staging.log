09:13:55 SQL> @/dbbackups/ECST/migrations/core_owner/84.1-sartre-release-1.18.0-changes/upgrade.sql
09:13:55 SQL> -- START CHANGE SCRIPT #20130801152708: 20130801152708-alter_ar_balance_indexes.sql
09:13:55 SQL> 
09:13:55 SQL> delete from
09:13:55   2  ar_balance_applies a
09:13:55   3  where
09:13:55   4  a.rowid >
09:13:55   5  any (select b.rowid
09:13:55   6  	      from
09:13:55   7  	      ar_balance_applies b
09:13:55   8  	      where
09:13:55   9  	      a.charge_id = b.charge_id
09:13:55  10  	      and
09:13:55  11  	      a.invoice_id = B.invoice_id
09:13:55  12  )
09:13:55  13  ;

0 rows deleted.

Elapsed: 00:00:25.25
09:14:20 SQL> commit;

Commit complete.

Elapsed: 00:00:00.00
09:14:20 SQL> 
09:14:20 SQL> ALTER TABLE AR_BALANCE_APPLIES ADD CONSTRAINT AR_APPLIES_PK PRIMARY KEY (CHARGE_ID, INVOICE_ID) ;

Table altered.

Elapsed: 00:00:11.60
09:14:31 SQL> ALTER TABLE AR_BALANCE_APPLIES ADD CONSTRAINT AR_APPLIES_CHARGEID_FK FOREIGN KEY (CHARGE_ID) REFERENCES CHARGE (ID);

Table altered.

Elapsed: 00:00:18.57
09:14:50 SQL> ALTER TABLE AR_BALANCE_APPLIES ADD CONSTRAINT AR_APPLIES_INVID_FK FOREIGN KEY (INVOICE_ID) REFERENCES INVOICE (ID);

Table altered.

Elapsed: 00:00:37.30
09:15:27 SQL> CREATE INDEX AR_BAL_APPLIES_CID_IDX ON AR_BALANCE_APPLIES (CHARGE_ID) TABLESPACE CORE_IDX;

Index created.

Elapsed: 00:00:22.31
09:15:50 SQL> CREATE INDEX AR_BAL_APPLIES_IID_IDX ON AR_BALANCE_APPLIES (INVOICE_ID) TABLESPACE CORE_IDX;
CREATE INDEX AR_BAL_APPLIES_IID_IDX ON AR_BALANCE_APPLIES (INVOICE_ID) TABLESPACE CORE_IDX
                                       *
ERROR at line 1:
ORA-00054: resource busy and acquire with NOWAIT specified or timeout expired 


Elapsed: 00:00:00.01
09:15:50 SQL> 
09:15:50 SQL> 
09:15:50 SQL> 
09:15:50 SQL> INSERT INTO dbdeploy_changelog (change_number, complete_dt, applied_by, description)
09:15:50   2  VALUES (20130801152708, CURRENT_TIMESTAMP, USER, '20130801152708-alter_ar_balance_indexes.sql');

1 row created.

Elapsed: 00:00:00.17
09:15:50 SQL> 
09:15:50 SQL> COMMIT;

Commit complete.

Elapsed: 00:00:00.01
09:15:50 SQL> 
09:15:50 SQL> -- END CHANGE SCRIPT #20130801152708: 20130801152708-alter_ar_balance_indexes.sql
09:15:50 SQL> 
09:15:50 SQL> 
09:15:50 SQL> -- START CHANGE SCRIPT #20130801152742: 20130801152742-alter_charge_status_indexes.sql
09:15:50 SQL> 
09:15:50 SQL> ALTER TABLE CHARGE_STATUS_LOG ADD CONSTRAINT CHARGE_STATUS_LOG_PK PRIMARY KEY (ID);

Table altered.

Elapsed: 00:01:30.95
09:17:21 SQL> ALTER TABLE CHARGE_STATUS_LOG ADD CONSTRAINT CHARGE_STATUS_LOG_CRG_ID_FK FOREIGN KEY (CHARGE_ID) REFERENCES CHARGE (ID);
ALTER TABLE CHARGE_STATUS_LOG ADD CONSTRAINT CHARGE_STATUS_LOG_CRG_ID_FK FOREIGN KEY (CHARGE_ID) REFERENCES CHARGE (ID)
            *
ERROR at line 1:
ORA-00054: resource busy and acquire with NOWAIT specified or timeout expired 


Elapsed: 00:00:00.00
09:17:21 SQL> ALTER TABLE CHARGE_STATUS_LOG ADD CONSTRAINT CHARGE_STATUS_LOG_CSSTAT_ID_FK FOREIGN KEY (CHARGE_STATUS_ID) REFERENCES CHARGE_STATUS (ID);
ALTER TABLE CHARGE_STATUS_LOG ADD CONSTRAINT CHARGE_STATUS_LOG_CSSTAT_ID_FK FOREIGN KEY (CHARGE_STATUS_ID) REFERENCES CHARGE_STATUS (ID)
            *
ERROR at line 1:
ORA-00054: resource busy and acquire with NOWAIT specified or timeout expired 


Elapsed: 00:00:00.00
09:17:21 SQL> CREATE INDEX CHARGE_STATUS_LOG_CID_IDX ON CHARGE_STATUS_LOG (CHARGE_ID) TABLESPACE CORE_IDX;

Index created.

Elapsed: 00:01:08.60
09:18:29 SQL> 
09:18:29 SQL> 
09:18:29 SQL> 
09:18:29 SQL> INSERT INTO dbdeploy_changelog (change_number, complete_dt, applied_by, description)
09:18:29   2  VALUES (20130801152742, CURRENT_TIMESTAMP, USER, '20130801152742-alter_charge_status_indexes.sql');

1 row created.

Elapsed: 00:00:00.00
09:18:29 SQL> 
09:18:29 SQL> COMMIT;

Commit complete.

Elapsed: 00:00:00.00
09:18:29 SQL> 
09:18:29 SQL> -- END CHANGE SCRIPT #20130801152742: 20130801152742-alter_charge_status_indexes.sql
09:18:29 SQL> 
09:18:29 SQL> commit;

Commit complete.

Elapsed: 00:00:00.00
09:18:29 SQL> spool off;
