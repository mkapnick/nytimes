13:46:38 SQL> @/dbbackups/ECPR/migrations/core_owner/77.1-create-edu-16-wk-gift-subs/upgrade.sql
13:46:38 SQL> WHENEVER SQLERROR EXIT SQL.SQLCODE ROLLBACK
13:46:38 SQL> SET SCAN OFF
13:46:38 SQL> SET DEFINE OFF
13:46:38 SQL> DECLARE
13:46:38   2  TMP_VAR NUMBER;
13:46:38   3  CUR_PRD_ID NUMBER;
13:46:38   4  CUR_CAPABILITY_ID NUMBER;
13:46:38   5  BEGIN
13:46:38   6  BEGIN
13:46:38   7  	SELECT 1 INTO TMP_VAR FROM OFFER_CHAIN WHERE ID = 99915001 AND ROWNUM <= 1;
13:46:38   8  	UPDATE OFFER_CHAIN SET NAME='NYTimes: Web + Smartphone App', DESCRIPTION='Unlimited access to NYTimes.com and the NYTimes smartphone app.*', PRODUCT_URI='', VENDOR_SOURCE_ID='1', BILLING_SOURCE_ID=(SELECT ID FROM BILLING_SOURCE BS WHERE BS.NAME='Sartre'), IS_SEAT_LICENSE=0, GROUP_ACCOUNT_TYPE_ID='NO',IS_ADDRESS_REQUIRED=1, OFFER_CHAIN_STATUS_ID = 1, UPDATE_DATE = SYSDATE, UPDATED_BY = 'OFFERMAKER', IS_GIFT_CERTIFICATE='1', REVOKE_ENTITLEMENTS = '0', ADOPTABILITY_WINDOW_START_DATE = to_date('15-Jul-2013 00:00:00','DD-MON-YY HH24:MI:SS'), ADOPTABILITY_WINDOW_END_DATE = to_date('01-Feb-2099 00:00:00','DD-MON-YY HH24:MI:SS'), AMAZON_APPSTORE_SKU=NULL WHERE ID = 99915001;
13:46:38   9  EXCEPTION
13:46:38  10  	WHEN NO_DATA_FOUND THEN
13:46:38  11  	  INSERT INTO OFFER_CHAIN (ID, NAME, DESCRIPTION, ADOPTABILITY_WINDOW_START_DATE, ADOPTABILITY_WINDOW_END_DATE, IS_GIFT_CERTIFICATE, PRODUCT_URI, OFFER_CHAIN_STATUS_ID, REVOKE_ENTITLEMENTS, VENDOR_SOURCE_ID, BILLING_SOURCE_ID, IS_SEAT_LICENSE, GROUP_ACCOUNT_TYPE_ID, IS_ADDRESS_REQUIRED, AMAZON_APPSTORE_SKU, CREATED_BY, CREATE_DATE, updated_by, update_date) VALUES (99915001, 'NYTimes: Web + Smartphone App', 'Unlimited access to NYTimes.com and the NYTimes smartphone app.*', to_date('15-Jul-2013 00:00:00','DD-MON-YY HH24:MI:SS'), to_date('01-Feb-2099 00:00:00','DD-MON-YY HH24:MI:SS'), '1', NULL, '1', '0', '1', (SELECT ID FROM BILLING_SOURCE BS WHERE BS.NAME='Sartre'), decode('NO','IL',1,0), 'NO', '1', '', 'OFFERMAKER', SYSDATE, 'OFFERMAKER', SYSDATE);
13:46:38  12  END;
13:46:38  13  DELETE FROM OFFER_CHAIN_ELIGIBILITY WHERE offer_chain_id = 99915001;
13:46:38  14  INSERT INTO OFFER_CHAIN_ELIGIBILITY (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (ELG_ID_SEQ.NEXTVAL, 99915001, 'IS_COMP', '0', 'OFFERMAKER', SYSDATE);
13:46:38  15  INSERT INTO OFFER_CHAIN_ELIGIBILITY (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (ELG_ID_SEQ.NEXTVAL, 99915001, 'REDEEMER_PROHIBITED_ENTITLEMENTS', 'mm,msd,mow,timesreader', 'OFFERMAKER', SYSDATE);
13:46:38  16  DELETE FROM OFFER_CHAIN_META_DATA WHERE offer_chain_id = 99915001;
13:46:38  17  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'BUNDLE_EXPLANATION', 'Bundle A - 16 Week Gift Sub - Purchase OC', 'OFFERMAKER', SYSDATE);
13:46:38  18  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'PRICE_DESCRIPTION', '4 Month Gift Subscription - $23.49 for 16 weeks - purchase', 'OFFERMAKER', SYSDATE);
13:46:38  19  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'PRICE_SHORT_DESCRIPTION', 'BNDL A / $23.49 16 wks GC purch', 'OFFERMAKER', SYSDATE);
13:46:38  20  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'OFFER_TYPE', 'Edu Digital Gift Subscription for 16 weeks', 'OFFERMAKER', SYSDATE);
13:46:38  21  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'OFFER_PRICE_DESCRIPTOR', '16 Weeks Gift Certificate', 'OFFERMAKER', SYSDATE);
13:46:38  22  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'OFFER_PRICE', '$23.49 for 16 weeks', 'OFFERMAKER', SYSDATE);
13:46:38  23  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'PROMO_PRICE_FOOTER_LABEL', '16 Weeks', 'OFFERMAKER', SYSDATE);
13:46:38  24  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'BILLING_CYCLE', 'You will be billed for a 16 week gift subscription in full.', 'OFFERMAKER', SYSDATE);
13:46:38  25  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'SUBSCRIBER_TYPE', 'Education', 'OFFERMAKER', SYSDATE);
13:46:38  26  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'ABOUT_ORDER', 'The full purchase price for gift subscriptions will be charged at the time of purchase and is non-refundable.  Redemption codes are not replaceable. Prices are in U.S. dollars and are subject to change. Other restrictions may apply.  Gift subscription period begins the day of redemption.  Redemption code expires five years after date of purchase.', 'OFFERMAKER', SYSDATE);
13:46:38  27  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'redemption offer chain id', '99915002', 'OFFERMAKER', SYSDATE);
13:46:38  28  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'OPEN_TO_ANONYMOUS', '1', 'OFFERMAKER', SYSDATE);
13:46:38  29  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'BUNDLE', 'Bundle A (Web+SP)', 'OFFERMAKER', SYSDATE);
13:46:38  30  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'ADX_BUNDLE', 'MM_EDU', 'OFFERMAKER', SYSDATE);
13:46:38  31  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'SIEBEL_CAMPAIGN_CODE', '3JKLR', 'OFFERMAKER', SYSDATE);
13:46:38  32  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'SOCIAL_DISPLAY', 'nyt-bundle', 'OFFERMAKER', SYSDATE);
13:46:38  33  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'ANNUAL_PRICE', '195.00', 'OFFERMAKER', SYSDATE);
13:46:38  34  INSERT INTO OFFER_CHAIN_META_DATA (ID, OFFER_CHAIN_ID, NAME, VALUE, CREATED_BY, CREATE_DATE) VALUES (OCMD_ID_SEQ.NEXTVAL, 99915001, 'UID', '50aaac1f7467b1dfe6a61ecee7de73fde84fb3e7164cff95114739b0d04472f9', 'OFFERMAKER', SYSDATE);
13:46:38  35  DELETE FROM OFFER_CHAIN_NOTIFICATION_TYPE WHERE offer_chain_id = 99915001;
13:46:38  36  BEGIN
13:46:38  37  	SELECT 1 INTO TMP_VAR FROM ACTION WHERE NAME = 'SUBSCRIBE_TO_OFFER_CHAIN';
13:46:38  38  EXCEPTION
13:46:38  39  	WHEN NO_DATA_FOUND THEN
13:46:38  40  	  INSERT INTO ACTION (ID, NAME, CREATE_DATE, CREATED_BY) VALUES (ACTION_ID_SEQ.NEXTVAL, 'SUBSCRIBE_TO_OFFER_CHAIN', SYSDATE, 'OFFERMAKER');
13:46:38  41  END;
13:46:38  42  BEGIN
13:46:38  43  	SELECT 1 INTO TMP_VAR FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-gift-purchase';
13:46:38  44  EXCEPTION
13:46:38  45  	WHEN NO_DATA_FOUND THEN NULL;
13:46:38  46  	  INSERT INTO CORE_OWNER.NOTIFICATION_TYPE (ID, VALUE, TEMPLATE_URL) VALUES (CORE_OWNER.NOTTID_SEQ.NEXTVAL, 'sartre-gift-purchase', 'N/A');
13:46:38  47  END;
13:46:38  48  BEGIN
13:46:38  49  	SELECT 1 INTO TMP_VAR FROM ACTION WHERE NAME = 'UPGRADE_SUBSCRIPTION';
13:46:38  50  EXCEPTION
13:46:38  51  	WHEN NO_DATA_FOUND THEN
13:46:38  52  	  INSERT INTO ACTION (ID, NAME, CREATE_DATE, CREATED_BY) VALUES (ACTION_ID_SEQ.NEXTVAL, 'UPGRADE_SUBSCRIPTION', SYSDATE, 'OFFERMAKER');
13:46:38  53  END;
13:46:38  54  BEGIN
13:46:38  55  	SELECT 1 INTO TMP_VAR FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-gift-purchase';
13:46:38  56  EXCEPTION
13:46:38  57  	WHEN NO_DATA_FOUND THEN NULL;
13:46:38  58  	  INSERT INTO CORE_OWNER.NOTIFICATION_TYPE (ID, VALUE, TEMPLATE_URL) VALUES (CORE_OWNER.NOTTID_SEQ.NEXTVAL, 'sartre-gift-purchase', 'N/A');
13:46:38  59  END;
13:46:38  60  BEGIN
13:46:38  61  	SELECT 1 INTO TMP_VAR FROM ACTION WHERE NAME = 'CANCEL_SUBSCRIPTION';
13:46:38  62  EXCEPTION
13:46:38  63  	WHEN NO_DATA_FOUND THEN
13:46:38  64  	  INSERT INTO ACTION (ID, NAME, CREATE_DATE, CREATED_BY) VALUES (ACTION_ID_SEQ.NEXTVAL, 'CANCEL_SUBSCRIPTION', SYSDATE, 'OFFERMAKER');
13:46:38  65  END;
13:46:38  66  BEGIN
13:46:38  67  	SELECT 1 INTO TMP_VAR FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-cancel';
13:46:38  68  EXCEPTION
13:46:38  69  	WHEN NO_DATA_FOUND THEN NULL;
13:46:38  70  	  INSERT INTO CORE_OWNER.NOTIFICATION_TYPE (ID, VALUE, TEMPLATE_URL) VALUES (CORE_OWNER.NOTTID_SEQ.NEXTVAL, 'sartre-cancel', 'N/A');
13:46:38  71  END;
13:46:38  72  BEGIN
13:46:38  73  	SELECT 1 INTO TMP_VAR FROM ACTION WHERE NAME = 'SYSTEM_CANCEL';
13:46:38  74  EXCEPTION
13:46:38  75  	WHEN NO_DATA_FOUND THEN
13:46:38  76  	  INSERT INTO ACTION (ID, NAME, CREATE_DATE, CREATED_BY) VALUES (ACTION_ID_SEQ.NEXTVAL, 'SYSTEM_CANCEL', SYSDATE, 'OFFERMAKER');
13:46:38  77  END;
13:46:38  78  BEGIN
13:46:38  79  	SELECT 1 INTO TMP_VAR FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-gift-decline';
13:46:38  80  EXCEPTION
13:46:38  81  	WHEN NO_DATA_FOUND THEN NULL;
13:46:38  82  	  INSERT INTO CORE_OWNER.NOTIFICATION_TYPE (ID, VALUE, TEMPLATE_URL) VALUES (CORE_OWNER.NOTTID_SEQ.NEXTVAL, 'sartre-gift-decline', 'N/A');
13:46:38  83  END;
13:46:38  84  BEGIN
13:46:38  85  	SELECT 1 INTO TMP_VAR FROM ACTION WHERE NAME = 'CREDIT_CARD_EXP';
13:46:38  86  EXCEPTION
13:46:38  87  	WHEN NO_DATA_FOUND THEN
13:46:38  88  	  INSERT INTO ACTION (ID, NAME, CREATE_DATE, CREATED_BY) VALUES (ACTION_ID_SEQ.NEXTVAL, 'CREDIT_CARD_EXP', SYSDATE, 'OFFERMAKER');
13:46:38  89  END;
13:46:38  90  BEGIN
13:46:38  91  	SELECT 1 INTO TMP_VAR FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'card_expiration';
13:46:38  92  EXCEPTION
13:46:38  93  	WHEN NO_DATA_FOUND THEN NULL;
13:46:38  94  	  INSERT INTO CORE_OWNER.NOTIFICATION_TYPE (ID, VALUE, TEMPLATE_URL) VALUES (CORE_OWNER.NOTTID_SEQ.NEXTVAL, 'card_expiration', 'N/A');
13:46:38  95  END;
13:46:38  96  BEGIN
13:46:38  97  	SELECT 1 INTO TMP_VAR FROM ACTION WHERE NAME = 'GC_REDEEMER_ON_PURCHASE';
13:46:38  98  EXCEPTION
13:46:38  99  	WHEN NO_DATA_FOUND THEN
13:46:38 100  	  INSERT INTO ACTION (ID, NAME, CREATE_DATE, CREATED_BY) VALUES (ACTION_ID_SEQ.NEXTVAL, 'GC_REDEEMER_ON_PURCHASE', SYSDATE, 'OFFERMAKER');
13:46:38 101  END;
13:46:38 102  BEGIN
13:46:38 103  	SELECT 1 INTO TMP_VAR FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-gift-subscription';
13:46:38 104  EXCEPTION
13:46:38 105  	WHEN NO_DATA_FOUND THEN NULL;
13:46:38 106  	  INSERT INTO CORE_OWNER.NOTIFICATION_TYPE (ID, VALUE, TEMPLATE_URL) VALUES (CORE_OWNER.NOTTID_SEQ.NEXTVAL, 'sartre-gift-subscription', 'N/A');
13:46:38 107  END;
13:46:38 108  BEGIN
13:46:38 109  	SELECT 1 INTO TMP_VAR FROM ACTION WHERE NAME = 'GC_REDEEMER_ON_PURCHASE_30DAY';
13:46:38 110  EXCEPTION
13:46:38 111  	WHEN NO_DATA_FOUND THEN
13:46:38 112  	  INSERT INTO ACTION (ID, NAME, CREATE_DATE, CREATED_BY) VALUES (ACTION_ID_SEQ.NEXTVAL, 'GC_REDEEMER_ON_PURCHASE_30DAY', SYSDATE, 'OFFERMAKER');
13:46:38 113  END;
13:46:38 114  BEGIN
13:46:38 115  	SELECT 1 INTO TMP_VAR FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-recipient-30days-reminder';
13:46:38 116  EXCEPTION
13:46:38 117  	WHEN NO_DATA_FOUND THEN NULL;
13:46:38 118  	  INSERT INTO CORE_OWNER.NOTIFICATION_TYPE (ID, VALUE, TEMPLATE_URL) VALUES (CORE_OWNER.NOTTID_SEQ.NEXTVAL, 'sartre-recipient-30days-reminder', 'N/A');
13:46:38 119  END;
13:46:38 120  BEGIN
13:46:38 121  	SELECT 1 INTO TMP_VAR FROM ACTION WHERE NAME = 'GC_REDEEMER_ON_PURCHASE_90DAY';
13:46:38 122  EXCEPTION
13:46:38 123  	WHEN NO_DATA_FOUND THEN
13:46:38 124  	  INSERT INTO ACTION (ID, NAME, CREATE_DATE, CREATED_BY) VALUES (ACTION_ID_SEQ.NEXTVAL, 'GC_REDEEMER_ON_PURCHASE_90DAY', SYSDATE, 'OFFERMAKER');
13:46:38 125  END;
13:46:38 126  BEGIN
13:46:38 127  	SELECT 1 INTO TMP_VAR FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-recipient-90days-reminder';
13:46:38 128  EXCEPTION
13:46:38 129  	WHEN NO_DATA_FOUND THEN NULL;
13:46:38 130  	  INSERT INTO CORE_OWNER.NOTIFICATION_TYPE (ID, VALUE, TEMPLATE_URL) VALUES (CORE_OWNER.NOTTID_SEQ.NEXTVAL, 'sartre-recipient-90days-reminder', 'N/A');
13:46:38 131  END;
13:46:38 132  BEGIN
13:46:38 133  	SELECT 1 INTO TMP_VAR FROM ACTION WHERE NAME = 'PURCHASE_GIFT_CERTIFICATE';
13:46:38 134  EXCEPTION
13:46:38 135  	WHEN NO_DATA_FOUND THEN
13:46:38 136  	  INSERT INTO ACTION (ID, NAME, CREATE_DATE, CREATED_BY) VALUES (ACTION_ID_SEQ.NEXTVAL, 'PURCHASE_GIFT_CERTIFICATE', SYSDATE, 'OFFERMAKER');
13:46:38 137  END;
13:46:38 138  BEGIN
13:46:38 139  	SELECT 1 INTO TMP_VAR FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-gift-purchase';
13:46:38 140  EXCEPTION
13:46:38 141  	WHEN NO_DATA_FOUND THEN NULL;
13:46:38 142  	  INSERT INTO CORE_OWNER.NOTIFICATION_TYPE (ID, VALUE, TEMPLATE_URL) VALUES (CORE_OWNER.NOTTID_SEQ.NEXTVAL, 'sartre-gift-purchase', 'N/A');
13:46:38 143  END;
13:46:38 144  INSERT INTO OFFER_CHAIN_NOTIFICATION_TYPE (ID, OFFER_CHAIN_ID, NOTIFICATION_TYPE_ID, ACTION_ID, CREATED_BY, CREATE_DATE) VALUES (OCET_ID_SEQ.NEXTVAL, 99915001, (SELECT ID FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-gift-purchase'), (SELECT ID FROM ACTION WHERE NAME = 'SUBSCRIBE_TO_OFFER_CHAIN'), 'OFFERMAKER', SYSDATE);
13:46:38 145  INSERT INTO OFFER_CHAIN_NOTIFICATION_TYPE (ID, OFFER_CHAIN_ID, NOTIFICATION_TYPE_ID, ACTION_ID, CREATED_BY, CREATE_DATE) VALUES (OCET_ID_SEQ.NEXTVAL, 99915001, (SELECT ID FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-gift-purchase'), (SELECT ID FROM ACTION WHERE NAME = 'UPGRADE_SUBSCRIPTION'), 'OFFERMAKER', SYSDATE);
13:46:38 146  INSERT INTO OFFER_CHAIN_NOTIFICATION_TYPE (ID, OFFER_CHAIN_ID, NOTIFICATION_TYPE_ID, ACTION_ID, CREATED_BY, CREATE_DATE) VALUES (OCET_ID_SEQ.NEXTVAL, 99915001, (SELECT ID FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-cancel'), (SELECT ID FROM ACTION WHERE NAME = 'CANCEL_SUBSCRIPTION'), 'OFFERMAKER', SYSDATE);
13:46:38 147  INSERT INTO OFFER_CHAIN_NOTIFICATION_TYPE (ID, OFFER_CHAIN_ID, NOTIFICATION_TYPE_ID, ACTION_ID, CREATED_BY, CREATE_DATE) VALUES (OCET_ID_SEQ.NEXTVAL, 99915001, (SELECT ID FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-gift-decline'), (SELECT ID FROM ACTION WHERE NAME = 'SYSTEM_CANCEL'), 'OFFERMAKER', SYSDATE);
13:46:38 148  INSERT INTO OFFER_CHAIN_NOTIFICATION_TYPE (ID, OFFER_CHAIN_ID, NOTIFICATION_TYPE_ID, ACTION_ID, CREATED_BY, CREATE_DATE) VALUES (OCET_ID_SEQ.NEXTVAL, 99915001, (SELECT ID FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'card_expiration'), (SELECT ID FROM ACTION WHERE NAME = 'CREDIT_CARD_EXP'), 'OFFERMAKER', SYSDATE);
13:46:38 149  INSERT INTO OFFER_CHAIN_NOTIFICATION_TYPE (ID, OFFER_CHAIN_ID, NOTIFICATION_TYPE_ID, ACTION_ID, CREATED_BY, CREATE_DATE) VALUES (OCET_ID_SEQ.NEXTVAL, 99915001, (SELECT ID FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-gift-subscription'), (SELECT ID FROM ACTION WHERE NAME = 'GC_REDEEMER_ON_PURCHASE'), 'OFFERMAKER', SYSDATE);
13:46:38 150  INSERT INTO OFFER_CHAIN_NOTIFICATION_TYPE (ID, OFFER_CHAIN_ID, NOTIFICATION_TYPE_ID, ACTION_ID, CREATED_BY, CREATE_DATE) VALUES (OCET_ID_SEQ.NEXTVAL, 99915001, (SELECT ID FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-recipient-30days-reminder'), (SELECT ID FROM ACTION WHERE NAME = 'GC_REDEEMER_ON_PURCHASE_30DAY'), 'OFFERMAKER', SYSDATE);
13:46:38 151  INSERT INTO OFFER_CHAIN_NOTIFICATION_TYPE (ID, OFFER_CHAIN_ID, NOTIFICATION_TYPE_ID, ACTION_ID, CREATED_BY, CREATE_DATE) VALUES (OCET_ID_SEQ.NEXTVAL, 99915001, (SELECT ID FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-recipient-90days-reminder'), (SELECT ID FROM ACTION WHERE NAME = 'GC_REDEEMER_ON_PURCHASE_90DAY'), 'OFFERMAKER', SYSDATE);
13:46:38 152  INSERT INTO OFFER_CHAIN_NOTIFICATION_TYPE (ID, OFFER_CHAIN_ID, NOTIFICATION_TYPE_ID, ACTION_ID, CREATED_BY, CREATE_DATE) VALUES (OCET_ID_SEQ.NEXTVAL, 99915001, (SELECT ID FROM CORE_OWNER.NOTIFICATION_TYPE WHERE VALUE = 'sartre-gift-purchase'), (SELECT ID FROM ACTION WHERE NAME = 'PURCHASE_GIFT_CERTIFICATE'), 'OFFERMAKER', SYSDATE);
13:46:38 153  BEGIN
13:46:38 154  	SELECT 1 INTO TMP_VAR FROM OFFER_OFFER_CHAIN WHERE OFFER_CHAIN_ID = 99915001 AND INDEX_VALUE = 0 AND ROWNUM <= 1;
13:46:38 155  EXCEPTION
13:46:38 156  	WHEN NO_DATA_FOUND THEN
13:46:38 157  INSERT INTO OFFER (ID, OFFER_STATUS_ID, ENTITLEMENT_DURATION, CREATED_BY, CREATE_DATE, updated_by, update_date) VALUES (OFR_ID_SEQ.NEXTVAL, 1, 'P0Y0M112DT0H0M', 'OFFERMAKER', SYSDATE, 'OFFERMAKER', SYSDATE);
13:46:38 158  BEGIN
13:46:38 159  	SELECT ID INTO CUR_PRD_ID FROM PRODUCT WHERE NAME = 'Web' AND ROWNUM <= 1;
13:46:38 160  EXCEPTION
13:46:38 161  	WHEN NO_DATA_FOUND THEN
13:46:38 162  	  INSERT INTO PRODUCT (ID, NAME, CREATED_BY, CREATE_DATE) VALUES (PRD_ID_SEQ.NEXTVAL, 'Web', 'OFFERMAKER', SYSDATE);
13:46:38 163  	  SELECT ID INTO CUR_PRD_ID FROM PRODUCT WHERE NAME = 'Web' AND ROWNUM <= 1;
13:46:38 164  	WHEN OTHERS THEN
13:46:38 165  	  RAISE;
13:46:38 166  END;
13:46:38 167  INSERT INTO PRODUCT_OFFERING (ID, PRODUCT_ID, TAX_POLICY_TYPE_ID, QUANTITY, UNIT_PRICE, CREATED_BY, CREATE_DATE) VALUES (PO_ID_SEQ.NEXTVAL, CUR_PRD_ID, '2', '112', '0.357143', 'OFFERMAKER', SYSDATE);
13:46:38 168  INSERT INTO OFFER_PRODUCT_OFFERING (OFFER_ID, PRODUCT_OFFERING_ID, CREATED_BY, CREATE_DATE) VALUES (OFR_ID_SEQ.CURRVAL, PO_ID_SEQ.CURRVAL, 'OFFERMAKER', SYSDATE);
13:46:38 169  INSERT INTO DISCOUNT (ID, NAME, DESCRIPTION, FIXED_AMOUNT, PERCENT_AMOUNT, DISCOUNT_TYPE_ID, CREATED_BY, CREATE_DATE) VALUES (DSC_ID_SEQ.NEXTVAL, 'Discount', 'Off: 23.49. P.Disc: 15.6600. P.Full: 40.0000', '24.34', '0', 1, 'OFFERMAKER', SYSDATE);
13:46:38 170  INSERT INTO DISCOUNT_PRODUCT_OFFERING (DISCOUNT_ID, PRODUCT_OFFERING_ID, CREATED_BY, CREATE_DATE) VALUES (DSC_ID_SEQ.CURRVAL, PO_ID_SEQ.CURRVAL, 'OFFERMAKER', SYSDATE);
13:46:38 171  BEGIN
13:46:38 172  	SELECT ID INTO CUR_PRD_ID FROM PRODUCT WHERE NAME = 'Mobile' AND ROWNUM <= 1;
13:46:38 173  EXCEPTION
13:46:38 174  	WHEN NO_DATA_FOUND THEN
13:46:38 175  	  INSERT INTO PRODUCT (ID, NAME, CREATED_BY, CREATE_DATE) VALUES (PRD_ID_SEQ.NEXTVAL, 'Mobile', 'OFFERMAKER', SYSDATE);
13:46:38 176  	  SELECT ID INTO CUR_PRD_ID FROM PRODUCT WHERE NAME = 'Mobile' AND ROWNUM <= 1;
13:46:38 177  	WHEN OTHERS THEN
13:46:38 178  	  RAISE;
13:46:38 179  END;
13:46:38 180  INSERT INTO PRODUCT_OFFERING (ID, PRODUCT_ID, TAX_POLICY_TYPE_ID, QUANTITY, UNIT_PRICE, CREATED_BY, CREATE_DATE) VALUES (PO_ID_SEQ.NEXTVAL, CUR_PRD_ID, '1', '112', '0', 'OFFERMAKER', SYSDATE);
13:46:38 181  INSERT INTO OFFER_PRODUCT_OFFERING (OFFER_ID, PRODUCT_OFFERING_ID, CREATED_BY, CREATE_DATE) VALUES (OFR_ID_SEQ.CURRVAL, PO_ID_SEQ.CURRVAL, 'OFFERMAKER', SYSDATE);
13:46:38 182  BEGIN
13:46:38 183  	SELECT ID INTO CUR_PRD_ID FROM PRODUCT WHERE NAME = 'Archive Article' AND ROWNUM <= 1;
13:46:38 184  EXCEPTION
13:46:38 185  	WHEN NO_DATA_FOUND THEN
13:46:38 186  	  INSERT INTO PRODUCT (ID, NAME, CREATED_BY, CREATE_DATE) VALUES (PRD_ID_SEQ.NEXTVAL, 'Archive Article', 'OFFERMAKER', SYSDATE);
13:46:38 187  	  SELECT ID INTO CUR_PRD_ID FROM PRODUCT WHERE NAME = 'Archive Article' AND ROWNUM <= 1;
13:46:38 188  	WHEN OTHERS THEN
13:46:38 189  	  RAISE;
13:46:38 190  END;
13:46:38 191  INSERT INTO PRODUCT_OFFERING (ID, PRODUCT_ID, TAX_POLICY_TYPE_ID, QUANTITY, UNIT_PRICE, CREATED_BY, CREATE_DATE) VALUES (PO_ID_SEQ.NEXTVAL, CUR_PRD_ID, '1', '400', '0', 'OFFERMAKER', SYSDATE);
13:46:38 192  INSERT INTO OFFER_PRODUCT_OFFERING (OFFER_ID, PRODUCT_OFFERING_ID, CREATED_BY, CREATE_DATE) VALUES (OFR_ID_SEQ.CURRVAL, PO_ID_SEQ.CURRVAL, 'OFFERMAKER', SYSDATE);
13:46:38 193  BEGIN
13:46:38 194  	SELECT ID INTO CUR_PRD_ID FROM PRODUCT WHERE NAME = 'TimesMachine' AND ROWNUM <= 1;
13:46:38 195  EXCEPTION
13:46:38 196  	WHEN NO_DATA_FOUND THEN
13:46:38 197  	  INSERT INTO PRODUCT (ID, NAME, CREATED_BY, CREATE_DATE) VALUES (PRD_ID_SEQ.NEXTVAL, 'TimesMachine', 'OFFERMAKER', SYSDATE);
13:46:38 198  	  SELECT ID INTO CUR_PRD_ID FROM PRODUCT WHERE NAME = 'TimesMachine' AND ROWNUM <= 1;
13:46:38 199  	WHEN OTHERS THEN
13:46:38 200  	  RAISE;
13:46:38 201  END;
13:46:38 202  INSERT INTO PRODUCT_OFFERING (ID, PRODUCT_ID, TAX_POLICY_TYPE_ID, QUANTITY, UNIT_PRICE, CREATED_BY, CREATE_DATE) VALUES (PO_ID_SEQ.NEXTVAL, CUR_PRD_ID, '1', '112', '0', 'OFFERMAKER', SYSDATE);
13:46:38 203  INSERT INTO OFFER_PRODUCT_OFFERING (OFFER_ID, PRODUCT_OFFERING_ID, CREATED_BY, CREATE_DATE) VALUES (OFR_ID_SEQ.CURRVAL, PO_ID_SEQ.CURRVAL, 'OFFERMAKER', SYSDATE);
13:46:38 204  BEGIN
13:46:38 205  	SELECT ID INTO CUR_PRD_ID FROM PRODUCT WHERE NAME = 'Smartphone' AND ROWNUM <= 1;
13:46:38 206  EXCEPTION
13:46:38 207  	WHEN NO_DATA_FOUND THEN
13:46:38 208  	  INSERT INTO PRODUCT (ID, NAME, CREATED_BY, CREATE_DATE) VALUES (PRD_ID_SEQ.NEXTVAL, 'Smartphone', 'OFFERMAKER', SYSDATE);
13:46:38 209  	  SELECT ID INTO CUR_PRD_ID FROM PRODUCT WHERE NAME = 'Smartphone' AND ROWNUM <= 1;
13:46:38 210  	WHEN OTHERS THEN
13:46:38 211  	  RAISE;
13:46:38 212  END;
13:46:38 213  INSERT INTO PRODUCT_OFFERING (ID, PRODUCT_ID, TAX_POLICY_TYPE_ID, QUANTITY, UNIT_PRICE, CREATED_BY, CREATE_DATE) VALUES (PO_ID_SEQ.NEXTVAL, CUR_PRD_ID, '2', '112', '0.178571', 'OFFERMAKER', SYSDATE);
13:46:38 214  INSERT INTO OFFER_PRODUCT_OFFERING (OFFER_ID, PRODUCT_OFFERING_ID, CREATED_BY, CREATE_DATE) VALUES (OFR_ID_SEQ.CURRVAL, PO_ID_SEQ.CURRVAL, 'OFFERMAKER', SYSDATE);
13:46:38 215  INSERT INTO DISCOUNT (ID, NAME, DESCRIPTION, FIXED_AMOUNT, PERCENT_AMOUNT, DISCOUNT_TYPE_ID, CREATED_BY, CREATE_DATE) VALUES (DSC_ID_SEQ.NEXTVAL, 'Discount', 'Off: 23.49. P.Disc: 7.8300. P.Full: 20.0000', '12.17', '0', 1, 'OFFERMAKER', SYSDATE);
13:46:38 216  INSERT INTO DISCOUNT_PRODUCT_OFFERING (DISCOUNT_ID, PRODUCT_OFFERING_ID, CREATED_BY, CREATE_DATE) VALUES (DSC_ID_SEQ.CURRVAL, PO_ID_SEQ.CURRVAL, 'OFFERMAKER', SYSDATE);
13:46:38 217  INSERT INTO OFFER_OFFER_CHAIN (OFFER_ID, OFFER_CHAIN_ID, INDEX_VALUE, NUM_RECURRENCES, CREATED_BY, CREATE_DATE, updated_by, update_date) VALUES (OFR_ID_SEQ.CURRVAL, 99915001, '0', '1', 'OFFERMAKER', SYSDATE, 'OFFERMAKER', SYSDATE);
13:46:38 218  END;
13:46:38 219  END;
13:46:38 220  /
DECLARE
*
ERROR at line 1:
ORA-01400: cannot insert NULL into 
("CORE_OWNER"."PRODUCT_OFFERING"."CAPABILITY_ID") 
ORA-06512: at line 167 
ORA-01403: no data found 




Subject: Nomad upgrade completed with errors: ECPR@rac01.prd.ewr1.nytimes.com
From: Nomad for Oracle <nytd_oracledba@nytimes.com>
To: nytd_ecommerce@nytimes.com
Cc: nytd_oracledba@nytimes.com

Nomad upgrade operation has errors. 
        
        Details
        -------
        DB Hostname: rac01.prd.ewr1.nytimes.com
        DB Role: PRIMARY
        SID: ECPR
        Schema: core_owner
        Migration: 77.1-create-edu-16-wk-gift-subs
        SVN Revision: 13606
        Duration: 1 sec.
        DBA: apathrose
                
        
        Error Detail
        ------------
        
        ERROR at line 1: ORA-01400: cannot insert NULL into ("CORE_OWNER"."PRODUCT_OFFERING"."CAPABILITY_ID") ORA-06512: at line 167 ORA-01403: no data found