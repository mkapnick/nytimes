09:32:04 SQL> @/dbbackups/ECST2/migrations/core_owner/82-ar-db-backfill-2-ecst2/upgrade.sql
09:32:04 SQL> 
09:32:04 SQL> -- Custom NYTimes template
09:32:04 SQL> WHENEVER SQLERROR EXIT SQL.SQLCODE ROLLBACK;
09:32:04 SQL> 
09:32:04 SQL> 
09:32:04 SQL> -- START CHANGE SCRIPT #20130801152708: 20130801152708-alter_ar_balance_indexes.sql
09:32:04 SQL> delete from
09:32:04   2  ar_balance_applies a
09:32:04   3  where
09:32:04   4  a.rowid >
09:32:04   5  any (select b.rowid
09:32:04   6  	      from
09:32:04   7  	      ar_balance_applies b
09:32:04   8  	      where
09:32:04   9  	      a.charge_id = b.charge_id
09:32:04  10  	      and
09:32:04  11  	      a.invoice_id = B.invoice_id
09:32:04  12  )
09:32:04  13  ;

0 rows deleted.

Elapsed: 00:00:35.12
09:32:39 SQL> commit;

Commit complete.

Elapsed: 00:00:00.01
09:32:39 SQL> 
09:32:39 SQL> ALTER TABLE AR_BALANCE_APPLIES ADD CONSTRAINT AR_APPLIES_PK PRIMARY KEY (CHARGE_ID, INVOICE_ID) ;

Table altered.

Elapsed: 00:00:21.47
09:33:00 SQL> ALTER TABLE AR_BALANCE_APPLIES ADD CONSTRAINT AR_APPLIES_CHARGEID_FK FOREIGN KEY (CHARGE_ID) REFERENCES CHARGE (ID);

Table altered.

Elapsed: 00:00:28.20
09:33:28 SQL> ALTER TABLE AR_BALANCE_APPLIES ADD CONSTRAINT AR_APPLIES_INVID_FK FOREIGN KEY (INVOICE_ID) REFERENCES INVOICE (ID);

Table altered.

Elapsed: 00:00:31.68
09:34:00 SQL> CREATE INDEX AR_BAL_APPLIES_CID_IDX ON AR_BALANCE_APPLIES (CHARGE_ID) TABLESPACE CORE_IDX;

Index created.

Elapsed: 00:00:20.94
09:34:21 SQL> CREATE INDEX AR_BAL_APPLIES_IID_IDX ON AR_BALANCE_APPLIES (INVOICE_ID) TABLESPACE CORE_IDX;

Index created.

Elapsed: 00:00:18.88
09:34:40 SQL> 
09:34:40 SQL> 
09:34:40 SQL> 
09:34:40 SQL> INSERT INTO dbdeploy_changelog (change_number, complete_dt, applied_by, description)
09:34:40   2  VALUES (20130801152708, CURRENT_TIMESTAMP, USER, '20130801152708-alter_ar_balance_indexes.sql');

1 row created.

Elapsed: 00:00:00.12
09:34:40 SQL> 
09:34:40 SQL> COMMIT;

Commit complete.

Elapsed: 00:00:00.00
09:34:40 SQL> 
09:34:40 SQL> -- END CHANGE SCRIPT #20130801152708: 20130801152708-alter_ar_balance_indexes.sql
09:34:40 SQL> 
09:34:40 SQL> 
09:34:40 SQL> -- START CHANGE SCRIPT #20130801152742: 20130801152742-alter_charge_status_indexes.sql
09:34:40 SQL> 
09:34:40 SQL> ALTER TABLE CHARGE_STATUS_LOG ADD CONSTRAINT CHARGE_STATUS_LOG_PK PRIMARY KEY (ID);

Table altered.

Elapsed: 00:01:00.38
09:35:40 SQL> ALTER TABLE CHARGE_STATUS_LOG ADD CONSTRAINT CHARGE_STATUS_LOG_CRG_ID_FK FOREIGN KEY (CHARGE_ID) REFERENCES CHARGE (ID);

Table altered.

Elapsed: 00:01:25.15
09:37:06 SQL> ALTER TABLE CHARGE_STATUS_LOG ADD CONSTRAINT CHARGE_STATUS_LOG_CSSTAT_ID_FK FOREIGN KEY (CHARGE_STATUS_ID) REFERENCES CHARGE_STATUS (ID);

Table altered.

Elapsed: 00:00:37.28
09:37:43 SQL> CREATE INDEX CHARGE_STATUS_LOG_CID_IDX ON CHARGE_STATUS_LOG (CHARGE_ID) TABLESPACE CORE_IDX;

Index created.

Elapsed: 00:00:47.90
09:38:31 SQL> 
09:38:31 SQL> 
09:38:31 SQL> 
09:38:31 SQL> INSERT INTO dbdeploy_changelog (change_number, complete_dt, applied_by, description)
09:38:31   2  VALUES (20130801152742, CURRENT_TIMESTAMP, USER, '20130801152742-alter_charge_status_indexes.sql');

1 row created.

Elapsed: 00:00:00.01
09:38:31 SQL> 
09:38:31 SQL> COMMIT;

Commit complete.

Elapsed: 00:00:00.00
09:38:31 SQL> 
09:38:31 SQL> -- END CHANGE SCRIPT #20130801152742: 20130801152742-alter_charge_status_indexes.sql
09:38:31 SQL> 
09:38:31 SQL> commit;

Commit complete.

Elapsed: 00:00:00.00
09:38:31 SQL> spool off;
